function nsppath()

tool = [
   1    0    0    0
   0    1    0    0
   0    0    1 0.08
   0    0    0    1];

TCPstart = [
-0.394066  0.736397 -0.549938 -0.545775
 0.907556   0.21731 -0.359331 -0.378089
-0.145103   -0.6407 -0.753955  0.286634];

raytarget = [-0.148389; -0.255468; -0.276436]; % debugIndex = 382 (0-based)

q(1) = 0.004202; c(1) = -0.068796; j(1,1) = 0.413875; j(1,2) = 0.663169; j(1,3) = 0.285616; j(1,4) = -1.543292; j(1,5) = -0.657532; j(1,6) = 0.283905; j(1,7) = 2.362770; 
q(2) = 0.013654; c(2) = -0.068517; j(2,1) = 0.358459; j(2,2) = 0.675348; j(2,3) = 0.367841; j(2,4) = -1.559732; j(2,5) = -0.826905; j(2,6) = 0.297169; j(2,7) = 2.500687; 
q(3) = 0.027202; c(3) = -0.067818; j(3,1) = 0.348383; j(3,2) = 0.679141; j(3,3) = 0.383496; j(3,4) = -1.582806; j(3,5) = -0.912590; j(3,6) = 0.287463; j(3,7) = 2.582580; 
q(4) = 0.044361; c(4) = -0.066663; j(4,1) = 0.462003; j(4,2) = 0.659531; j(4,3) = 0.222716; j(4,4) = -1.611210; j(4,5) = -0.733801; j(4,6) = 0.212578; j(4,7) = 2.471687; 
q(5) = 0.064826; c(5) = -0.064684; j(5,1) = 0.490752; j(5,2) = 0.659820; j(5,3) = 0.186852; j(5,4) = -1.643919; j(5,5) = -0.794167; j(5,6) = 0.176388; j(5,7) = 2.549935; 
q(6) = 0.088381; c(6) = -0.060127; j(6,1) = 0.521454; j(6,2) = 0.662703; j(6,3) = 0.150485; j(6,4) = -1.680028; j(6,5) = -0.921536; j(6,6) = 0.138353; j(6,7) = 2.696003; 
q(7) = 0.114860; c(7) =  0.090980; j(7,1) = 0.617152; j(7,2) = 0.666043; j(7,3) = 0.029576; j(7,4) = -1.718690; j(7,5) = -0.927756; j(7,6) = 0.067827; j(7,7) = 2.754662; 

% q = ((1:25)/25).^1.7

n = numel(q);

for i=1:n
	[T,nsp,cfg] = FK_LWR4(j(i,:));
	%T1 = T(:,:,end) * tool;
	nsps(i) = nsp;
end

nsteps = 250; nnsp = 250;

nsppic = zeros(nnsp, nsteps);

for istep=1:nsteps
	T = TCPstart;
	qq = (istep-1)/(nsteps-1);
	T(1:3,4) = TCPstart(1:3,4)*(1-qq) + raytarget*qq;
	T(4,:) = [0 0 0 1];
	for insp=1:nnsp
		jtest = IK_matlab(T,(insp-1)/(nnsp-1)*2*pi-pi, 2);
		ctest = cost2(jtest, jtest);
		nsppic(insp, istep) = ctest;
	end
end

nsppic(nsppic > 0) = 0;
nsppic = nsppic.^3;

h = pcolor(nsppic);
set(h,'edgecolor', 'none')
x = get(h, 'xdata');
y = get(h, 'ydata');
x = (x-1)/(nsteps-1);
y = (y-1)/(nnsp-1)*2*pi-pi;
set(h, 'xdata', x, 'ydata', y);

axis([0,1,-pi,pi])
shading interp

line(q, nsps, 'color', 'red')


